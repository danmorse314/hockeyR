<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Collect and Clean Hockey Stats • hockeyR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Collect and Clean Hockey Stats">
<meta property="og:description" content="This package contains various functions to scrape hockey play-by-play 
  data from the NHL API. It also contains functions to scrape data
  from hockey-reference.com, including standings, player stats, and jersey number
  history.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">hockeyR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/hockeyR.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/danmorse314/hockeyR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="hockeyr" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#hockeyr" class="anchor"></a>hockeyR</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>This package contains various functions to scrape and clean play-by-play data from NHL.com. Season play-by-play data scraped with these functions can be found in the <a href="https://github.com/danmorse314/hockeyR-data">hockeyR-data</a> repository. It also contains functions to scrape data from hockey-reference.com, including standings, player stats, and jersey number history.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Before installing, confirm that your version of R is updated to at least 4.1.0. This will ensure R can handle R’s native pipe operator <code>|&gt;</code>, which was unavailable until 4.1.0. If you don’t know which version of R is installed, try <code>verson$version.string</code> in your R console.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">version</span><span class="op">$</span><span class="va">version.string</span>
<span class="co">#&gt; [1] "R version 4.1.0 (2021-05-18)"</span></code></pre></div>
<p>You can install the development version of <code>hockeyR</code> from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"danmorse314/hockeyR"</span><span class="op">)</span></code></pre></div>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>Load the package (and any others you might need—for plotting an ice surface I highly recommend the <a href="https://github.com/rossdrucker/sportyR">sportyR</a> package).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/danmorse314/hockeyR">hockeyR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'ggplot2' was built under R version 4.1.1</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rossdrucker/sportyR">sportyR</a></span><span class="op">)</span></code></pre></div>
<div id="loading-season-play-by-play" class="section level4">
<h4 class="hasAnchor">
<a href="#loading-season-play-by-play" class="anchor"></a>Loading season play-by-play</h4>
<p>The fastest way to load a season’s play-by-play data is through the <code><a href="reference/load_pbp.html">load_pbp()</a></code> function, which pulls the desired season(s) from <a href="https://github.com/danmorse314/hockeyR-data/tree/main/data">hockeyR-data</a>. <code><a href="reference/load_pbp.html">load_pbp()</a></code> also has the advantage of accepting more explicit values for the seasons desired. For example, if you want to get the play-by-play for the 2020-2021 NHL season, all of <code><a href="reference/load_pbp.html">load_pbp('2020-2021')</a></code>, <code><a href="reference/load_pbp.html">load_pbp('2020-21')</a></code>, and <code><a href="reference/load_pbp.html">load_pbp(2021)</a></code> will get it for you.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pbp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="st">'2020-21'</span><span class="op">)</span>
<span class="co">#&gt; Fetching 2020_21 season play-by-play...</span>
<span class="co">#&gt; Done!</span>
<span class="co">#&gt; Loaded 868 regular season games &amp; 84 postseason games for 2020_21</span></code></pre></div>
<p>The available data goes back to the 2010-2011 season as of now, as the NHL JSON source used for this scraper doesn’t include detailed play-by-play prior to that.</p>
<p>All variables available in the raw play-by-play data are included, along with a few extras added on including: - shot_distance - shot_angle - x_fixed - y_fixed The <code>shot_distance</code> and <code>shot_angle</code> are measured in feet and degrees, respectively. The variables <code>x_fixed</code> and <code>y_fixed</code> are transformations of the <code>x</code> and <code>y</code> event coordinates such that the home team is always shooting to the right and the away team is always shooting to the left. For full details on the included variables, see the <a href="https://github.com/danmorse314/hockeyR/blob/master/R/scrape_game.R"><code>scrape_game()</code></a> documentation.</p>
<p>As mentioned above, an easy way to create a shot plot is through the <a href="https://github.com/rossdrucker/sportyR">sportyR</a> package. You can also use the included <code>team_colors_logos</code> data to add color and team logos to your plots.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get single game</span>
<span class="va">game</span> <span class="op">&lt;-</span> <span class="va">pbp</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">game_date</span> <span class="op">==</span> <span class="st">"2021-07-07"</span> <span class="op">&amp;</span> <span class="va">home_abbreviation</span> <span class="op">==</span> <span class="st">"TBL"</span><span class="op">)</span>

<span class="co"># grab team logos &amp; colors</span>
<span class="va">team_logos</span> <span class="op">&lt;-</span> <span class="fu">hockeyR</span><span class="fu">::</span><span class="va"><a href="reference/team_logos_colors.html">team_logos_colors</a></span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">team_abbr</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">game</span><span class="op">$</span><span class="va">home_abbreviation</span><span class="op">)</span> <span class="op">|</span> <span class="va">team_abbr</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">game</span><span class="op">$</span><span class="va">away_abbreviation</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="co"># add in dummy variables to put logos on the ice</span>
  <span class="fu">mutate</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">full_team_name</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">game</span><span class="op">$</span><span class="va">home_name</span><span class="op">)</span>, <span class="fl">50</span>, <span class="op">-</span><span class="fl">50</span><span class="op">)</span>,
         y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="co"># add transparency to logo</span>
<span class="va">transparent</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">img</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">magick</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/magick/reference/fx.html">image_fx</a></span><span class="op">(</span><span class="va">img</span>, expression <span class="op">=</span> <span class="st">"0.5*a"</span>, channel <span class="op">=</span> <span class="st">"alpha"</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># get only shot events</span>
<span class="va">fenwick_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"MISSED_SHOT"</span>,<span class="st">"SHOT"</span>,<span class="st">"GOAL"</span><span class="op">)</span>

<span class="va">shots</span> <span class="op">&lt;-</span> <span class="va">game</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">event_type</span> <span class="op">%in%</span> <span class="va">fenwick_events</span><span class="op">)</span> |&gt;
  <span class="co"># adding team colors</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">team_logos</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"event_team_abbr"</span> <span class="op">=</span> <span class="st">"team_abbr"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># create shot plot</span>
<span class="fu"><a href="https://rdrr.io/pkg/sportyR/man/geom_hockey.html">geom_hockey</a></span><span class="op">(</span><span class="st">"nhl"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggimage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggimage/man/geom_image.html">geom_image</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">team_logos</span>,
    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, image <span class="op">=</span> <span class="va">team_logo_espn</span><span class="op">)</span>,
    image_fun <span class="op">=</span> <span class="va">transparent</span>, size <span class="op">=</span> <span class="fl">0.22</span>, asp <span class="op">=</span> <span class="fl">2.35</span>
    <span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">shots</span>,
    <span class="fu">aes</span><span class="op">(</span><span class="va">x_fixed</span>, <span class="va">y_fixed</span><span class="op">)</span>,
    size <span class="op">=</span> <span class="fl">6</span>,
    color <span class="op">=</span> <span class="va">shots</span><span class="op">$</span><span class="va">team_color1</span>,
    shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">shots</span><span class="op">$</span><span class="va">event_type</span> <span class="op">==</span> <span class="st">"GOAL"</span>, <span class="fl">19</span>, <span class="fl">1</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{unique(game$away_name)} @ {unique(game$home_name)}"</span><span class="op">)</span>,
    subtitle <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span>
    <span class="st">"{unique(game$game_date)}\n
    {unique(shots$away_abbreviation)} {unique(shots$away_final)} - {unique(shots$home_final)} {unique(shots$home_abbreviation)}"</span>
    <span class="op">)</span>,
    caption <span class="op">=</span> <span class="st">"data from hockeyR | plot made with sportyR"</span>
    <span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>
    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,
    plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-shot-plot-example-1.png" width="100%"></p>
</div>
<div id="future-work" class="section level4">
<h4 class="hasAnchor">
<a href="#future-work" class="anchor"></a>Future Work</h4>
<p>Getting clean data for games going back to the start of the NHL RTSS era (2007-2008 season) is in the works. There are also plans to create a basic expected goals model and perhaps a win probability model that would include xG values for each shot and win probabilities for each play, similar to the expected points model found in the <a href="https://github.com/nflverse/nflfastR">nflfastR</a> package. And of course, scraping the upcoming NHL season and updating the data daily is planned for the 2021-2022 season.</p>
</div>
<div id="hockey-reference-scrapers" class="section level3">
<h3 class="hasAnchor">
<a href="#hockey-reference-scrapers" class="anchor"></a>Hockey-Reference scrapers</h3>
<p>There are a few functions also included that will scrape data from <a href="https://hockey-reference.com">hockey-reference.com</a>.</p>
<p>Grab every team’s win-loss record in any season going back to 1918 with the <code><a href="reference/get_team_records.html">get_team_records()</a></code> function</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/get_team_records.html">get_team_records</a></span><span class="op">(</span><span class="fl">1967</span><span class="op">)</span> |&gt;
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">w</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">select</span><span class="op">(</span><span class="va">team_name</span>, <span class="va">team_abbr</span>, <span class="va">season</span>, <span class="va">overall</span>, <span class="va">w</span>, <span class="va">l</span>, <span class="va">otl</span>, <span class="va">st_points</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 8</span>
<span class="co">#&gt;   team_name           team_abbr season  overall      w     l   otl st_points</span>
<span class="co">#&gt;   &lt;chr&gt;               &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Chicago Black Hawks CBH       1966-67 41-17-12    41    17    12        94</span>
<span class="co">#&gt; 2 Montreal Canadiens  MTL       1966-67 32-25-13    32    25    13        77</span>
<span class="co">#&gt; 3 Toronto Maple Leafs TOR       1966-67 32-27-11    32    27    11        75</span>
<span class="co">#&gt; 4 New York Rangers    NYR       1966-67 30-28-12    30    28    12        72</span>
<span class="co">#&gt; 5 Detroit Red Wings   DET       1966-67 27-39-4     27    39     4        58</span>
<span class="co">#&gt; 6 Boston Bruins       BOS       1966-67 17-43-10    17    43    10        44</span></code></pre></div>
<p>You can also get stats down to the player-level with <code><a href="reference/get_player_stats_hr.html">get_player_stats_hr()</a></code>. This function defaults to the player’s career statistics, but you can enter a specific season or range of seasons as well. Note that the season references the year the specific season ended (ie the 2021-22 season should be entered as 2022)</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/get_player_stats_hr.html">get_player_stats_hr</a></span><span class="op">(</span>player_name <span class="op">=</span> <span class="st">"Wayne Gretzky"</span>, season <span class="op">=</span> <span class="fl">1982</span><span class="op">)</span> |&gt;
  <span class="fu">select</span><span class="op">(</span><span class="va">player</span>, <span class="va">age</span>, <span class="va">season_full</span>, <span class="va">tm</span>, <span class="va">gp</span>, <span class="va">g</span>, <span class="va">a</span>, <span class="va">pts</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 8</span>
<span class="co">#&gt;   player          age season_full tm       gp     g     a   pts</span>
<span class="co">#&gt;   &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;       &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1 Wayne Gretzky    21 1981-82     EDM      80    92   120   212</span></code></pre></div>
<p>Ever wonder who the most prolific goal-scorer was to wear a specific number? Use <code><a href="reference/get_jersey_players.html">get_jersey_players()</a></code> in conjunction with <code><a href="reference/get_player_stats_hr.html">get_player_stats_hr()</a></code> to find out:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get every player to wear the desired number</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_jersey_players.html">get_jersey_players</a></span><span class="op">(</span><span class="fl">98</span><span class="op">)</span>

<span class="co"># get their statistics from the year they wore that sweater</span>
<span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2_dfr</a></span><span class="op">(</span>
  .x <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">player</span>,
  .y <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">season</span>,
  <span class="op">~</span><span class="fu"><a href="reference/get_player_stats_hr.html">get_player_stats_hr</a></span><span class="op">(</span>player_name <span class="op">=</span> <span class="va">.x</span>, season <span class="op">=</span> <span class="va">.y</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># who had the most goals?</span>
<span class="fu">arrange</span><span class="op">(</span><span class="va">df2</span>, <span class="fu">desc</span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">select</span><span class="op">(</span><span class="va">player</span>, <span class="va">tm</span>, <span class="va">season_full</span>, <span class="va">gp</span>, <span class="va">g</span>, <span class="va">a</span>, <span class="va">pts</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 11 x 7</span>
<span class="co">#&gt;    player            tm    season_full    gp     g     a   pts</span>
<span class="co">#&gt;    &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt;       &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1 Jesse Puljujarvi  EDM   2017-18        65    12     8    20</span>
<span class="co">#&gt;  2 Brian Lawton      MNS   1983-84        58    10    21    31</span>
<span class="co">#&gt;  3 Mikhail Sergachev TBL   2019-20        70    10    24    34</span>
<span class="co">#&gt;  4 Mikhail Sergachev TBL   2017-18        79     9    31    40</span>
<span class="co">#&gt;  5 Mikhail Sergachev TBL   2018-19        75     6    26    32</span>
<span class="co">#&gt;  6 Brian Lawton      MNS   1984-85        40     5     6    11</span>
<span class="co">#&gt;  7 Jesse Puljujarvi  EDM   2018-19        46     4     5     9</span>
<span class="co">#&gt;  8 Mikhail Sergachev TBL   2020-21        56     4    26    30</span>
<span class="co">#&gt;  9 Victor Mete       OTT   2020-21        14     1     1     2</span>
<span class="co">#&gt; 10 Jesse Puljujarvi  EDM   2016-17        28     1     7     8</span>
<span class="co">#&gt; 11 Victor Mete       MTL   2020-21        14     0     3     3</span></code></pre></div>
<p>You can use the data to make plots with actual team colors and logos as well using the <code>team_logos_colors</code> file included with the package.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add colors &amp; logos</span>
<span class="va">df3</span> <span class="op">&lt;-</span> <span class="va">df2</span> |&gt;
  <span class="fu">group_by</span><span class="op">(</span><span class="va">player</span>, <span class="va">season_full</span><span class="op">)</span> |&gt;
  <span class="co"># this part is just to get both of Mete's teams into one row</span>
  <span class="fu">summarize</span><span class="op">(</span>
    gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">gp</span><span class="op">)</span>,
    pts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pts</span><span class="op">)</span>,
    pts_gm <span class="op">=</span> <span class="va">pts</span><span class="op">/</span><span class="va">gp</span>,
    tm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">tm</span>, n<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,
    .groups <span class="op">=</span> <span class="st">"drop"</span>
  <span class="op">)</span> |&gt;
  <span class="fu">mutate</span><span class="op">(</span>player_season <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{player}\n{season_full}"</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">left_join</span><span class="op">(</span><span class="va">team_logos_colors</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tm"</span> <span class="op">=</span> <span class="st">"team_abbr"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># make a bar chart</span>
<span class="va">df3</span> |&gt;
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">player_season</span>, <span class="op">-</span><span class="va">pts_gm</span><span class="op">)</span>, <span class="va">pts_gm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">df3</span><span class="op">$</span><span class="va">team_color1</span>, color <span class="op">=</span> <span class="va">df3</span><span class="op">$</span><span class="va">team_color2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggimage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggimage/man/geom_image.html">geom_image</a></span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">pts_gm</span> <span class="op">+</span> <span class="fl">.027</span>, image <span class="op">=</span> <span class="va">team_logo_espn</span><span class="op">)</span>,
    size <span class="op">=</span> <span class="fl">.07</span>, asp <span class="op">=</span> <span class="fl">1.5</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0.01</span>, label <span class="op">=</span> <span class="va">player_season</span><span class="op">)</span>,
            color <span class="op">=</span> <span class="st">"white"</span>, angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_pretty.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>
    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
    plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
    panel.grid.major.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.text.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.ticks.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,
    title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Points per game"</span>,
       title <span class="op">=</span> <span class="st">"Most productive NHL seasons wearing #98"</span>,
       caption <span class="op">=</span> <span class="st">"data pulled from hockey-reference.com using hockeyR"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-plot-example-1.png" width="100%"> The most reliable way to grab player stats is through the <code><a href="reference/get_rosters.html">get_rosters()</a></code> function. The <code><a href="reference/get_player_stats_hr.html">get_player_stats_hr()</a></code> function still has some kinks to be worked out, as it works based on the player name (and messes up if you want to differentiate the Sebastian Ahos).</p>
<p>With <code><a href="reference/get_rosters.html">get_rosters()</a></code>, you can look up the current roster for any team in the league or the roster at season’s end for any prior season. By default, it will only pull basic player info (name, age, height &amp; weight, etc), but you can grab all the basic counting stats by setting <code>include_stats</code> to <code>TRUE</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">player_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_rosters.html">get_rosters</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"COL"</span>,<span class="st">"Detroit red wings"</span><span class="op">)</span>, season <span class="op">=</span> <span class="fl">2001</span>, include_stats <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> |&gt;
  <span class="fu">mutate</span><span class="op">(</span>
    g_60 <span class="op">=</span> <span class="fl">60</span> <span class="op">*</span> <span class="va">g</span> <span class="op">/</span> <span class="va">toi</span>,
    a_60 <span class="op">=</span> <span class="fl">60</span> <span class="op">*</span> <span class="va">a</span> <span class="op">/</span><span class="va">toi</span>,
    p_60 <span class="op">=</span> <span class="fl">60</span> <span class="op">*</span> <span class="va">pts</span> <span class="op">/</span> <span class="va">toi</span>
  <span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">toi</span> <span class="op">&gt;=</span> <span class="fl">300</span><span class="op">)</span> |&gt;
  <span class="fu">left_join</span><span class="op">(</span><span class="va">team_logos_colors</span>, by <span class="op">=</span> <span class="st">"team_abbr"</span><span class="op">)</span>

<span class="va">top_performers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span>
      <span class="va">player_stats</span>,
      <span class="va">p_60</span> <span class="op">&gt;=</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">player_stats</span>, <span class="op">-</span><span class="va">p_60</span><span class="op">)</span> |&gt; <span class="fu">slice</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> |&gt; <span class="fu">pull</span><span class="op">(</span><span class="va">p_60</span><span class="op">)</span>
      <span class="op">)</span>

<span class="va">player_stats</span> |&gt;
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">a_60</span>,<span class="va">g_60</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">60</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">player_stats</span><span class="op">$</span><span class="va">g</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">player_stats</span><span class="op">$</span><span class="va">toi</span><span class="op">)</span>,
             linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">60</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">player_stats</span><span class="op">$</span><span class="va">a</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">player_stats</span><span class="op">$</span><span class="va">toi</span><span class="op">)</span>,
             linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">#geom_point(aes(size = toi), show.legend = FALSE,</span>
  <span class="co">#           color = player_stats$team_color_alt1, alpha = .8) +</span>
  <span class="fu">ggimage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggimage/man/geom_image.html">geom_image</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>image <span class="op">=</span> <span class="va">team_logo_espn</span><span class="op">)</span>,
                      size <span class="op">=</span> <span class="fl">0.07</span>, asp <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">top_performers</span>,
    <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">player</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="va">top_performers</span><span class="op">$</span><span class="va">team_color_alt1</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_pretty.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_pretty.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>
    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#708090"</span><span class="op">)</span>,
    plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#708090"</span><span class="op">)</span>,
    title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Assists/60"</span>, y <span class="op">=</span> <span class="st">"Goals/60"</span>,
       title <span class="op">=</span> <span class="st">"2000-01 Wings v Avs, regular season stats"</span>,
       subtitle <span class="op">=</span> <span class="st">"min. 300 minutes"</span>,
       caption <span class="op">=</span> <span class="st">"data pulled from hockey-reference.com using hockeyR"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-rosters-1.png" width="100%"></p>
</div>
</div>
<div id="acknowledgements" class="section level2">
<h2 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>Acknowledgements</h2>
<ul>
<li>Everyone involved in making the <a href="https://github.com/nflverse">nflverse</a>, the premier data source for NFL stats that inspired this whole project</li>
<li>The <a href="https://twitter.com/EvolvingWild">Evolving Wild</a> twins, whose old NHL scraper helped enormously in getting player on-ice data joined to the raw play-by-play data in here.</li>
<li>
<a href="https://twitter.com/_TanHo">Tan Ho</a>, whose twitch streams on <a href="https://www.youtube.com/watch?v=z8yT3E4pz54&amp;t=26s">web scraping</a> and <a href="https://www.youtube.com/watch?v=fpw4G2-0R-o&amp;t=1195s">JSON wrangling</a> quite literally took me from 0 web scraping knowledge to building this package</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/danmorse314/hockeyR/">https://​github.com/​danmorse314/​hockeyR/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/danmorse314/hockeyR/issues">https://​github.com/​danmorse314/​hockeyR/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Daniel Morse <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Daniel Morse.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
